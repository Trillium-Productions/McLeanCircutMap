<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width height=device-height user-scalable=no">
    <title>Central Map Page</title>
    <link rel="stylesheet" href="../resources/libraries/jquery-ui.css">
    <script src="../resources/libraries/jquery-2.2.2.js"></script>
    <script src="../resources/libraries/jquery-ui.js"></script>
    <style>
        body {
            background: linear-gradient(to bottom right, #a49cc1, #d99c76);
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            left: 0;
            top: 0;
        }
        #total-content {
            position: absolute;
            width: 200vw;
            height: 100vh;
            background-color: transparent;
            left: 0;
            top: 0;
        }
        #top-content, #bottom-content {
            position: absolute;
            width: 100vw;
            height: 100vh;
            background-color: transparent;
            top: 0;
        }
        #top-content {
            left: 0;
        }
        #bottom-content {
            left: 100vw;
        }
        #top-content > img {
            position: absolute;
            height: auto;
        }
        #top-title {
            left: 4%;
            top: 1.6%;
            width: 51.4%;
        }
        #poster {
            left: 3.3%;
            top: 26.1%;
            width: 38.4%;
        }
        #pointing-hand {
            left: 37.4%;
            top: 25.1%;
            width: 15.3%;
            z-index: 5000;
        }
        #time-slider {
            left: 14.5%;
            top: 64.4%;
            width: 75.6%;
        }
        #graph-title {
            left: 13.5%;
            top: 71.5%;
            width: 41.4%;
        }
        #graph-main {
            left: 3.439%;
            top: 77.2%;
            width: 36.76%;
        }
        #map-bkg {
            left: 43.3%;
            top: 23.8%;
            width: 51.1%;
        }
    </style>
    <script>
        const YEAR_VALUE = {
            YEAR_1839: 0,
            YEAR_1843: 1,
            YEAR_1853: 2,
            YEAR_1860: 3
        };

        var ImageGroup = function (prefix) {
            this.images = [
                $('#' + prefix + '-1839'),
                $('#' + prefix + '-1843'),
                $('#' + prefix + '-1853'),
                $('#' + prefix + '-1860')
            ];
            this.currentImage = YEAR_VALUE.YEAR_1839;
        };

        ImageGroup.prototype.setImage = function(toImage, duration) {
            if (toImage < 0 || toImage > 3 || this.currentImage == toImage) {
                return;
            }
            this.images[this.currentImage].fadeOut(duration);
            this.images[toImage].fadeIn(duration);
            this.currentImage = toImage;
        };

        var RedArrow = function () {
            this.textLabel = new ImageGroup("arrow-text");
            this.container = $('#arrow-container');
            this.coordinates = [
                {
                    right: "85.6%",
                    bottom: "8%"
                },
                {
                    right: "81.04%",
                    bottom: "10.45%"
                },
                {
                    right: "69.33%",
                    bottom: "16.58%"
                },
                {
                    right: "62.23%",
                    bottom: "21.64%"
                }
            ];
        };

        RedArrow.prototype.setYear = function (year) {
            if (year < 0 || year > 3 || this.textLabel.currentImage == year) {
                return;
            }
            this.container.animate(this.coordinates[year], 900);
            this.textLabel.setImage(year);
        };

        var TopManager = function () {
            this.topText = new ImageGroup('top-text');
            this.counties = new ImageGroup('counties');
            this.popDensities = new ImageGroup('pop-density');
            this.arrow = new RedArrow();
            this.currentYear = YEAR_VALUE.YEAR_1839;
        };

        TopManager.prototype.setYear = function (year) {
            if (year < 0 || year > 3 || this.currentYear == year) {
                return;
            }
            this.currentYear = year;
            this.topText.setImage(year, 900);
            this.counties.setImage(year, 900);
            this.popDensities.setImage(year, 900);
            this.arrow.setYear(year);
        };

        var SlidePoint = function (xvalue, yvalue) {
            this.x = xvalue;
            this.y = yvalue;
        };

        SlidePoint.prototype.getDistance = function (somex, somey) {
            const dx = this.x - somex;
            const dy = this.y - somey;
            return Math.sqrt((dx * dx) + (dy * dy));
        };

        SlidePoint.prototype.getProperties = function () {
            return {
                left: this.x + '%'
            };
        };

        const pointsForSlider = [
                new SlidePoint(21.28, 64.45),
                new SlidePoint(40.64, 64.45),
                new SlidePoint(61.07, 64.45),
                new SlidePoint(79.36, 64.45)
        ];

        var topManager;

        function onKnobDragEnd (event, ui) {
            var placement = [
                100 * ui.position.left / window.innerWidth,
                100 * ui.position.top / window.innerHeight
            ];
            var mindist = 100;
            var minindex = 0;
            for (var i = 0; i < 4; i++) {
                var distance = pointsForSlider[i].getDistance(placement[0], placement[1]);
                if (distance < mindist) {
                    mindist = distance;
                    minindex = i;
                }
            }
            $('#slider-knob').animate(pointsForSlider[minindex].getProperties(), 900);
            topManager.setYear(minindex);
        }
    </script>
    <style>
        .top-text {
            position: absolute;
            top: 5.7%;
            width: 84.4%;
            left: 7.8%;
            height: auto;
            display: none;
        }
        #top-text-1839 {
            display: block;
        }
        .counties {
            position: absolute;
            z-index: 1000;
            height: auto;
            display: none;
        }
        #counties-1839 {
            top: 38.1530%;
            left: 57.9028%;
            width: 26.3591%;
            display: block;
        }
        #counties-1843 {
            top: 38.0732%;
            left: 57.9979%;
            width: 30.3743%;
        }
        #counties-1853 {
            top: 40.0439%;
            left: 62.0873%;
            width: 31.1043%;
        }
        #counties-1860 {
            top: 41.7094%;
            left: 66.9853%;
            width: 26.2041%;
        }
        .arrow-text {
            position: absolute;
            top: 9%;
            left: 9%;
            width: 66.67%;
            height: auto;
            display: none;
        }
        #arrow-text-1839 {
            display: block;
        }
        #red-arrow {
            position: absolute;
            width: 100%;
            height: 100%;
            right: 0;
            bottom: 0;
        }
        #arrow-container {
            position: absolute;
            width: 4.255%;
            height: 2.506%;
            right: 85.6%;
            bottom: 8%;
        }
        .pop-density {
            position: absolute;
            top: 77.2%;
            left: 42%;
            width: 24.8%;
            height: auto;
            display: none;
        }
        #pop-density-1839 {
            display: block;
        }
        #slider-range {
            position: absolute;
            left: 21.28%;
            width: 61.83%;
            top: 64.45%;
            height: 2%;
        }
        #slider-knob {
            position: absolute;
            left: 21.28%;
            height: 2%;
            width: 3.75%;
            top: 64.45%;
        }
        #nascent-cover {
            position: absolute;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(to bottom right, #a49cc1, #d99c76);
            z-index: 10000;
        }
    </style>
    <script>
        window.onload = function () {
            $('#nascent-cover').fadeOut(1500);
            // TODO: start timeout timer

            topManager = new TopManager();
            $('#slider-knob').draggable({
                axis: 'x',
                containment: '#slider-range',
                scroll: false,
                stop: onKnobDragEnd
            });

            // TODO: stuff for county/city map
        };

        var canAnimate = true;
    </script>
</head>
<body>
    <div id="nascent-cover">
        <!-- this div is simply a cover for when the page is not yet loaded -->
    </div>
    <div id="total-content">
        <div id="top-content">
            <img id="top-title" src="../resources/main-maps-screen/title-text.png">
            <img id="top-text-1839" class="top-text" src="../resources/main-maps-screen/1839/top-text.png">
            <img id="top-text-1843" class="top-text" src="../resources/main-maps-screen/1843/top-text.png">
            <img id="top-text-1853" class="top-text" src="../resources/main-maps-screen/1853/top-text.png">
            <img id="top-text-1860" class="top-text" src="../resources/main-maps-screen/1860/top-text.png">
            <img id="map-bkg" src="../resources/main-maps-screen/il-bkg.png">
            <img id="counties-1839" class="counties" src="../resources/main-maps-screen/1839/counties.png">
            <img id="counties-1843" class="counties" src="../resources/main-maps-screen/1843/counties.png">
            <img id="counties-1853" class="counties" src="../resources/main-maps-screen/1853/counties.png">
            <img id="counties-1860" class="counties" src="../resources/main-maps-screen/1860/counties.png">
            <img id="poster" src="../resources/main-maps-screen/poster.png" onclick="onPosterClick()">
            <script>
                function onPosterClick() {
                    canAnimate = false;
                    $('#pointing-hand').animate(
                            {
                                left: '42.6%',
                                top: '22.1%'
                            },
                            500,
                            function (event) {
                                $('#pointing-hand').animate(
                                        {
                                            left: '37.4%',
                                            top: '25.1%'
                                        },
                                        500,
                                        function (event2) {
                                            canAnimate = true;
                                            $('#total-content').animate({left: '-100vw'}, 900);
                                        }
                                );
                            }
                    );
                }
            </script>
            <img id="pointing-hand" src="../resources/main-maps-screen/hand.png">
            <img id="time-slider" src="../resources/main-maps-screen/slider.png">
            <div id="slider-range">
                <!-- defines constraint for #slider-knob dragging action -->
            </div>
            <img id="slider-knob" src="../resources/main-maps-screen/slider-knob.png">
            <img id="graph-title" src="../resources/main-maps-screen/graph-title.png">
            <img id="graph-main" src="../resources/main-maps-screen/graph-bkg.png">
            <div id="arrow-container">
                <img id="red-arrow" src="../resources/main-maps-screen/red-arrow.png">
                <img id="arrow-text-1839" class="arrow-text" src="../resources/main-maps-screen/1839/arrow-text.png">
                <img id="arrow-text-1843" class="arrow-text" src="../resources/main-maps-screen/1843/arrow-text.png">
                <img id="arrow-text-1853" class="arrow-text" src="../resources/main-maps-screen/1853/arrow-text.png">
                <img id="arrow-text-1860" class="arrow-text" src="../resources/main-maps-screen/1860/arrow-text.png">
            </div>
            <img id="pop-density-1839" class="pop-density" src="../resources/main-maps-screen/1839/pop-density.png">
            <img id="pop-density-1843" class="pop-density" src="../resources/main-maps-screen/1843/pop-density.png">
            <img id="pop-density-1853" class="pop-density" src="../resources/main-maps-screen/1853/pop-density.png">
            <img id="pop-density-1860" class="pop-density" src="../resources/main-maps-screen/1860/pop-density.png">
        </div>
        <div id="bottom-content">
            <!-- TODO: McLean County and Bloomington Maps -->
        </div>
    </div>
</body>
</html>